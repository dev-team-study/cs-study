# 매모리 관리
## 메모리 관리 필요성
프로세스간에는 기본적으로 독립된 메모리 공간을 가지고 있고, 운영체제가 이를 관리하는 시스템을 갖추고 있다. 
한정된 메모리를 효율적으로 사용해야 하는게 중요해졌고, 이걸 관리하는 운영체제의 중요성도 높아짐.

## 메모리 할당

### 연속 할당 => 메모리에 연속적으로 공간을 할당
- 프로세스가 순차적으로 공간에 할당된다.
- 고정 분할 방식 : 메모리를 미리 나누어 관리해 융통성이 없고 메모리보다 프로그램이 작아 그 공간에 들어가지 못할 수 있음
- 가변 분할 방식 : 동적으로 프로그램에 맞게 메모리를 나눈다.(최초,최적,최악)

### 불연속 할당 -> 메모리를 연속적으로 할당하지 않는다(현대 운영체제)
### 페이징
- 동일한 크기의 페이지 단위로 나누어 메모리의 서로 다른 위치에 할당한다.(주소 변환이 복잡)
- 관리가 단순하고 효율적이다. 고정 분할 방식과 유사하다. 하지만, 외부 단화가 발생해 세그먼트에 비해 공유와 보호가 복잡하다.

### 세그멘테이션
- 페이지 단위가 아니라 의미 단위로 나누는 것, 코드와 데이터 등 혹은 함수 단위로 메모리를 나눈다.(크기가 균일하지 않을 수 있음)
- 미리 메모를 분할하지 않는다. 가변 분할과 유사하다. 하지만, 주소 변환 과정에서 많은 오버헤드가 발생한다. 
- 페이지 세그먼테이션 : 공유난 보안을 의미단위인 세그먼트로 나누고, 물리적 메모리는 페이지로 나눈다.

# 가상 메모리

### 정의
Virtual = Logical (가상은 논리적이다.)
프로세스 전체가 메모리에 올라가지 않아도 실행할 수 있는 기법이다. 실제 메모리 주소와 가상 메모리 주소를 매핑해

### 가상메모리의 장점
- 한 프로세스가 잘못된 행동을 해서 죽어버리면 메모리가 낭비가 된다.
- 이때는 가상영역이라면 낭비가 된 메모리 or 하드를 를 그냥 회수해서 사용할 수 있게됨
- OS는 결국은 손상을 입지 않음(프로그램이 잘못되도 os는 살아있음)
- 가상 메모리의 하나의 단위 : 페이지 (윈도우 기준 : 4kb)

### 만약 메모리가 남는 공간이 없는데, 새로운 프로세스가 실행되어야 한다면?
- (페이지 out, swap out) 메모리에서 거의 사용되지 않는 프로그램을 하드로 옮기고 메모리 공간을 남긴다.
- 문제점 : hdd i/o (하드로 돌아가 컴퓨터의 성능이 급격히 느려짐)
- 이러다가 메모리에 빈 공간이 늘어나면, 페이지-in swap-in

### 가상메모리 IPC(inter process communication)
- 가상 메모리는 독립적이다. 프로세스마다 가상 메모리를 소지한다. 다른 프로세스에 접근할 수 없음
- 하지만 일부 메모리와 가상 메모리를 공유해서 사용할 수 있도록 OS가 페이지 블록을 매핑한다면?
- A가상 메모리가 공유 메모리에 작성, B가상 메모리에서 공유 메모리를 읽음 **(공유)**
- ex : copy & paste(워드의 내용을 복사해서 ppt에 붙여넣는다.)
- 프로세스간 통신 기법 (공유 메모리)

- 가상 메모리 주소는 MAU를 통해 실제 메모리 주소로 변환된다.
- 메모리와 CPU사이의 주소 변환을 위한 캐시

### 페이지 폴트
- 프로세스 주소 공간에는 존재하지만 RAM에 없는 데이터에 접근하면 페이지 폴트가 발생한다.
- 이때 운영체제는 이게 전혀 발생하지 않은 것처럼 프로그램이 작동하게 해준다.

1. CPU는 물리 메모리를 확인하다가 페이지가 없으면 트랩을 발생시켜 운영체제에게 알린다.
2. 운영체제는 CPU 동작을 멈춘다.
3. 운영체제는 페이지 테이블을 확인해 가상 메모리를 확인하고, 없으면 프로세스를 중단해 현재 물리 메모리를 확인한다.
4. 여기에도 없다면 스와핑을 작동한다.
5. 중단된 CPU를 실행한다.

### 스레싱
- 메므리의 페이지 폴트율이 높은 것을 의미한다.(심각한 성능 저하 )
- 페이지 폴트가 일어나면 CPU이용률이 낮아진다. 그러면 운영체제는 CPU가 여유있는줄 알고 여러 프로세스를 메모리에 올린다.
- 메모리를 늘리거나 hdd를 사용, 혹은 ssd를 사용한다.

pff
- 페이지 폴트 빈도를 조절해 상한과 하한을 조절해 페이지를 조절한다.

작업 세트 OPT
- 프로세스 사용 이력인 지역성을 통해서 페이지 집합을 미리 메모리에 로드해둔다.
- 앞으로 가장 오랫동안 사용하지 않을 페이지를 교체, 페이지 폴트가 가장 적음

페이지 교체 알고리즘
스와핑이 많이 일어나기 때문에 알고리즘이 필요함
- 오프라인 알고리즘 : 먼 미래에 사용될 페이지와 현재 페이지를 변경(알수 없지만 이론적인 기준)
- FIFO, LRU(참조가 가장 오래된), LFU(참조가 빈번하지 않은)