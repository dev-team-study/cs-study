# 운영체제

### 운영체제의 정의
- 사용자에게 편리성을 제공하고 컴퓨터의 자원을 효율적으로 관리한다.

### 운영체제의 역할
- 메모리 관리, cpu 및 프로세스 관리, 입출력 디바이스 관리,

### 사용자 인터페이스
- 사용자와 컴퓨터를 연결해준다. 커널은 하드웨어를 제어하기 때문에 사용자 인터페이스로 접근한다.
- CLI, GUI, Shell

### 유저 모드
- 사용자 모드는 일반 사용자의 프로그램이 실행되고 제한적인 명령을 수행한다. (mode bit 1)
- 코드를 작성하고 프로세스를 실행할 수 있음

### 커널 모드 
- cpu제어권을 가지고 컴퓨터 자원에 접근이 가능하다. (mode bit 0)
- 운영체제가 커널에 접근하기 위한 인터페이스
- 파일을 읽는다면, 커널모드로 들어와서 파일을 읽고 다시 유저모드로 돌아가 로직을 수행함
- 컴퓨터 자원에 직접 접근 차단, 프로그램을다른 프로그램으로부터 보호한다.

### 시스템 콜
- 시스템 인터페이스를 통해서 커널 모드로 진입하는 방법 시스템 내부에서 주변 기기와 통신(읽기 쓰기)하는 방법
- 시스템콜을 직접 사용하기 보다는 API를 통해 사용한다.
- jni : native코드가 시스템 콜을 사용한다. 

# 프로세스
- 프로세스 : 실행파일(프로그램)이 메모리에 적재되어 cpu를 할당받아 실행되는 것

### 메모리
- 메모리 :  CPU가 직접 접근할 수 있는 기억장치. CPU에서 실행되려면 메모리에 내용이 적재된 상태여야 함
- 메모리는(code(프로그램 코드),data(전역,static변수),stack,heap으로 이루어져 있고 프로세스마다 독립적으로 할당받는다.)

### 메모리 관리
- 여러 프로세스가 동시에 memory에 접근하더라도 서로의 영역에 침범하지 않도록 운영체제가 관리해줌

### context switch
- 스위칭 될때마다 이전에 어디까지 수행했고 register에 어떤 값이 저장되어있는지 정보가 필요한데 이 총체적인 정보를 context라고 함
- 한 프로세스에서 다른 프로세스로 cpu 제어권을 넘겨주는 것. 이떄 상태는 pcb에 저장하고 새로운 pcb를 읽어 보관된 상태를 복구한다.

### pc register
- pc(program counter) register에 다음에 실행할 코드에 주소값이 저장되어있음
- 메모리에 적제된 code영역의 명령어중 다음 연산에서 읽어야할 명령어의 주소값을 pc register가 가리키고, 해당 명령어를 읽어 cpu를 연산을 하면 process가 실행되는 것

### pcb(process control block)
- pcb는 커널의 데이터 공간에 존재하는 프로세스 정보를 저장하는 자료구조. pcb를 통해서 실행상태에서 준비 상태로 작업 상황을 저장하고 시작지점을 알려준다.
- 일반 사용자가 접근하지 못하도록 보호된 메모리에 저장된다.
- pcb는 pc값을 저장하고 있다. 하지만 멀티스레드 환경에서는 tcb에 pc값을 저장하고 있다.

### 프로세스 상태
- 생성,준비,실행,대기 종료
- 생성 : 프로세스에 메모리가 할당되고 PCB가 생성된 상태를 의미함
- 준비 : 프로세스가 CPU를 할당받고 실행될때가지 순서를 기다림, ready큐에서 기다리고 cpu 스케쥴러에 의해 관리된다.
- 실행 : 프로세스가 실제 작업을 수행한다.
- 완료 : 메모리가 헤재되고 PCB가 삭제된다.

## 멀티프로세스, 멀티 스레드

### 멀티 프로세스
- 여러개의 프로세스로 2가지 이상의 일을 동시에 수행할 수 있다.(동시성, 병렬성)
- 동시성(single core) : CPU 코어가 1개일 때 여러 process를 짧은 시간동안 번갈아가면서 연산하는 시분할 시스템으로 실행된다.
- 병렬성(multi core) : CPU 코어가 여러개일대 각 코어가 각 process를 연산해 process가 동시에 실행된다.
- process들은 cpu와 메모리를 공유한다.하나의 cpu는 하나의 process만 수행하는데,
처리속도가 빨라서 여러 process를 cpu에서 번갈아 실행해 동시에 실행되는 것처럼 보이는 것(시분할 시스템)

### 멀티 스레드
- 하나의 프로세스가 동시에 여러개의 task를 실행할 수 있도록 함. 여러 작업을 병렬로 처리할 수 있음
- 멀티스레드는 stack을 제외한 나머지(code,data,heap)을 공유한다.
- 스레드는 프로세스 내에서 독립적인 기능을 한다. 독립적으로 함수를 호출해 stack 메모리가 필요

### 멀티스레드 vs 멀티 프로세스
- 멀티스레드는 context switching이 빠르다.
- 메모리공간,cpu를 멀티 프로세스가 많이 차지한다.
- 멀티스레드는 하나의 스레드 장애로 전체가 위협받을 수 있음, 멀티프로세스는 그러지 않음
- 메모리 구분이 필요한 경우는 multi process, 데이터 공유가 빈번하고 자원을 효율적으로 사용한다면 멀티 스레드를 사용해야 한다.

### 멀티프로세스가 프로세스간 데이터를 주고 받는 방법
- inter process communication(ipc) 파이프, 소켓, 공유메모리, 파일이 있음
- ipc-공유메모리 : 프로세스가 주소 공간의 일부를 공유한다. 공유 메모리에 읽기 쓰기로 통신함
- 공유 메모리 할당을 커널에게 요청하고 커널은 프로세스에게 메모리 공간을 할당. 이후에는 커널없이도 해당 영역에 접근할 수 있어 속도가 빠름
- but 동시성 문제로 일관성 문제가 발생할 수 있다. 프로세스간 합의 필요

- 메시지 전달 : systemCall을 활용함. 커널을 통해 send receive연산으로 메ㅔㅅ지를 주고받음.
- 커널을 항사아 거쳐 속도가 느리지만 충돌을 회피할 수 있고 구현이 쉽다. (pipe, socket, message, queue가 있음)

### 멀티 프로세스 스레드에서 동기화 문제를 해결하는 방법
- 뮤텍스 : 1개의 스레드만이 공유자원에 접근한다. race condition을 방지한다.(락을 획득하고 락을 반환한다.)
- 세마포어 : S개의 스레드만이 공유자원에 접근할 수 있도록 제어한다. 자원에 접근할 때는 S--로
세마포 값을 감소, 방출시에는 S++를 수행해 값을 증가시킨다. 
- 세마포가 0 이면 모든 자원이 사용중이고, 그동안은 block이 된다.

- 임계영역 : 둘 이상의 process/thread가 동시에 동일한 자원에 접근하는 프로그램 코드다.
- 한 p/t가 임계영역에 들어가면 다른 p/t가 들어갈 수 없다.