## 03. 정규화, 트랜잭션
> 고범준

### 이상현상
삽입 이상(Insertion Anomaly)
- 새로운 데이터를 삽입할 때 원하지 않는 추가 정보를 함께 입력해야 하는 문제입니다.
예를 들어, 학생과 강좌에 관한 정보가 한 테이블에 모두 저장되어 있을 때, 새로운 학생 정보만 입력하려면 해당 학생이 수강하는 강좌 정보까지 입력해야 합니다.


삭제 이상(Deletion Anomaly)
- 어떤 정보를 삭제할 때 연관된 다른 정보까지 함께 삭제되는 문제입니다. 위의 예를 계속 사용하면,
특정 강좌를 수강하는 모든 학생들의 정보가 삭제되면, 그 강좌에 관한 정보도 함께 사라질 수 있습니다.


갱신 이상(Update Anomaly)
- 정보를 갱신할 때 여러 위치에서 동일한 정보를 수정해야 하는 문제입니다. 같은 정보가 여러 곳에 중복 저장되어 있을 때,
그 정보를 갱신하려면 여러 위치에서 일관되게 수정하는 것이 필요하며, 그렇지 않으면 데이터가 불일치하게 됩니다.

### 정규화
데이터베이스의 정규화는 데이터의 중복성을 최소화하고 무결성을 유지하기 위한 설계 기법입니다. 정규화 과정에서 여러 정규 형태를 거치게 되는데, 각 정규 형태는 특정 조건을 만족시킵니다. 다음은 관계형 데이터베이스의 주요 정규 형태에 대한 설명입니다:

1. **1NF (제1정규형)**
    - 각 테이블의 컬럼 값은 원자 값(Atomic value)으로 구성되어야 합니다. 즉, 하나의 컬럼에 여러 개의 값이 들어가서는 안 됩니다.
    - 기본키(Primary Key)가 존재하여 각 행(Row)을 고유하게 식별할 수 있어야 합니다.

2. **2NF (제2정규형)**
    - 1NF를 만족하면서, 부분 함수 종속성(Partial Functional Dependency)을 제거해야 합니다.
    - 이는 `복합 기본키를 가진 테이블에서만 발생하며`, 테이블의 어떤 컬럼이 복합키의 일부에만 종속되어 있으면 안 됩니다.
    즉, 복합키의 일부만으로 나머지 컬럼의 값을 유추할 수 있으면 안됨.

3. **3NF (제3정규형)**
    - 2NF를 만족하면서, 이행적 함수 종속성(Transitive Functional Dependency)을 제거해야 합니다.
    - 기본키가 아닌 컬럼들 간에 종속성이 존재하면 안 됩니다.

### 트랜잭션
- 트랜잭션은 작업의 완전성을 보장해 주는 것. 즉 논리적인 작업을 모두 완벽하게 처리하거나, 
  처리하지 못할 경우에는 원상복구해서 작업이 일부만 적용되는 현상이 발생하지 않게 만들어주는 기능

### ACID
- 원자성: 트랜잭션 내에 쿼리가 모두 성공하거나 실패하거나
- 일관성: 데이터베이스 데이터가 일관성있게 즉 데이터가 깨지지 않게끔 하는것
- 격리성: 트랜잭션 충돌을 막을 수 있게끔 격리레벨 설정을 통해 트랜잭션 충돌을 낮출수있다.
- 영존성: 커밋된 트랜잭션은 영구적으로 저장되어야 한다(DB 시스템에 문제가 생겨도 문제가 되지 않게끔)

### 비일관성 문제
- Dirty Read: 한 트랜잭션에서 아직 커밋되지 않은 변경을 다른 트랜잭션이 읽는 현상.
- Non-Repeatable Read: 한 트랜잭션 내에서 같은 데이터를 여러 번 읽을 때마다 값이 다르게 보이는 현상.
- Phantom Read: 한 트랜잭션에서 일련의 행(레코드)을 여러 번 읽을 때 새로운 행이 추가되거나 삭제되는 현상.

### Isolation Level
> 격리레벨(Isolation Level)은 데이터베이스에서 여러 트랜잭션이 동시에 실행될 때 어떠한 정도로 트랜잭션을 격리시킬 것인지를 정의하는 수준입니다.
  격리레벨에 따라 트랜잭션의 동시 실행성(concurrency)와 데이터의 일관성(consistency) 사이의 균형을 조절할 수 있습니다.

- Read Uncommitted
> 가장 낮은 격리 수준.
다른 트랜잭션에서 커밋되지 않은 데이터를 읽을 수 있음.
Dirty Read 문제가 발생할 수 있음.
동시성은 매우 높지만 데이터의 일관성이 떨어짐.

- Read Committed
> 대부분의 데이터베이스 시스템의 기본 격리 수준.
커밋된 데이터만 읽을 수 있음.
Dirty Read는 방지하지만, Non-Repeatable Read는 발생할 수 있음.

- Repeatable Read
> 한 트랜잭션 내에서 같은 데이터를 여러 번 읽을 때 항상 동일한 결과를 보장.
Dirty Read와 Non-Repeatable Read를 방지.
하지만 Phantom Read는 발생할 수 있음.

- Serializable
> 가장 높은 격리 수준.
트랜잭션들이 순차적으로 실행되어야 함을 의미, 즉 트랜잭션 간의 동시성이 없음.
Dirty Read, Non-Repeatable Read, Phantom Read 모두 방지.
동시성은 가장 낮지만 데이터의 일관성은 최고.

### DeadLock
> 데드락(Deadlock)은 여러 프로세스나 스레드, 트랜잭션 등이 서로를 기다리는 상황

`발생조건 4가지`
- 상호 배제 (Mutual Exclusion)
> 리소스는 한 번에 하나의 프로세스 또는 트랜잭션에만 할당될 수 있습니다. 즉, 동시에 두 개 이상의 프로세스나 트랜잭션에 의해 공유될 수 없는 리소스가 있어야 합니다.

- 점유 및 대기 (Hold and Wait)
> 프로세스나 트랜잭션이 어떤 리소스를 점유하면서 다른 리소스를 기다리는 상태가 될 수 있어야 합니다. 예를 들어, 프로세스 A가 리소스 X를 가지고 있으면서 동시에 리소스 Y를 기다리는 상황이 있을 수 있습니다.


- 비선점 (No Preemption)
> 이미 할당된 리소스는 강제로 회수될 수 없습니다. 즉, 한 프로세스나 트랜잭션이 리소스를 점유하고 있으면 다른 프로세스나 트랜잭션에 의해 그 리소스를 강제로 빼앗길 수 없습니다.

- 순환 대기 (Circular Wait)
> 프로세스나 트랜잭션의 집합에서, 각각의 프로세스나 트랜잭션이 다음 프로세스나 트랜잭션에 의해 점유된 리소스를 기다리는 순환 구조를 형성하고 있어야 합니다. 예를 들어, 프로세스 A가 프로세스 B가 점유한 리소스를 기다리고, 프로세스 B는 프로세스 C가 점유한 리소스를 기다리며, 프로세스 C는 다시 프로세스 A가 점유한 리소스를 기다리는 상황이 있을 수 있습니다.


### 질문 목록
- 잠금(Lock)과 트랜잭션의 차이점을 간략하게 설명해주세요.
> 잠금은 동시성을 제어하기 위한 기능이고 트랜잭션은 데이터의 정합성을 보장하기 위한 기능입니다.

- 일관성보다 동시성이 더 중요할 때 고려할 수 있는 격리레벨을 말씀해주세요.
> Read Uncommitted 동시성은 매우 높지만 데이터의 일관성이 떨어짐.

- 데이터베이스에서 데드락의 발생 조건 4가지를 설명하고, 데드락을 예방하거나 해결하기 위한 방법에 대해 말씀해주세요.
> 상호 배제 (Mutual Exclusion): 한 번에 하나의 프로세스나 트랜잭션만이 리소스를 점유할 수 있어야 합니다.<br>
> 점유 및 대기 (Hold and Wait): 프로세스나 트랜잭션이 일부 리소스를 이미 점유하고 있으면서 다른 리소스를 기다리는 상황이 발생해야 합니다.<br>
비선점 (No Preemption): 이미 할당된 리소스는 중간에 다른 프로세스나 트랜잭션에 의해 강제로 빼앗길 수 없습니다.<br>
순환 대기 (Circular Wait): 여러 프로세스나 트랜잭션들이 서로를 기다리는 순환 구조를 형성해야 합니다.<br>
데드락 예방 및 해결 방법:<br>
데드락 예방: 발생 조건 중 하나 이상을 무효화시킴으로써 데드락이 발생하지 않도록 하는 방법입니다. 예를 들어, 리소스 요청을 한번에 요청하게 해서 점유 및 대기 조건을 제거할 수 있습니다.<br>
데드락 감지: 시스템에서 주기적으로 데드락을 감지하고, 감지된 데드락을 해결하기 위해 특정 프로세스나 트랜잭션을 중단시키는 방법입니다.<br>
데드락 회피: 프로세스나 트랜잭션에 리소스를 할당할 때 안전성 검사를 수행하여 데드락의 발생 가능성이 있는 상황을 회피하는 방법입니다.<br>

- 비일관성 문제 중 'Phantom Read'가 무엇인지 설명하고, 이를 방지하기 위한 격리 레벨은 무엇인지 답변해주세요.
> Phantom Read'는 한 트랜잭션 내에서 일련의 행(레코드)을 여러 번 읽을 때 트랜잭션의 실행 사이에 새로운 행이 추가되거나 삭제되는 현상을 의미하고
> Phantom Read를 방지하기 위한 격리 레벨은 Serializable입니다. 또한 MySQL의 RepeatableRead에서도 일부 해결 가능합니다.
