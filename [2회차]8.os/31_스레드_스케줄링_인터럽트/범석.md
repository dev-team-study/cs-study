## 스레드

### 스레드 개념

스레드는 한 프로세스 내에서 실행되는 동작의 단위이다. 

각 스레드는 속해 있는 프로세스의 stack 메모리를 제외한 나머지 메모리 영역을 공유할 수 있다. 

### 멀티스레드의 구조

하나의 프로세스 내에서 여러 스레드가 동시에 실행된다.

### 멀티스레드의 장단점

장점 

- 메모리 공간과 시스템 자원 소모가 줄어들게 된다. 
- process간의IPC보다 thread 간의 통신 비용이 적기 때뭉네 통신으로 인한 오버헤드가 적다. 

단점

- 스레드 간 자원을 공유하기 때문에 동기화 문제가 발생할 수 잇어 이를 고려한 프로그램 설계가 필요하다. 

### 멀티 프로세스 VS 멀티 스레드

|               | 메모리 사용 / CPU 시간      | Context Switching | 안정성 |
| ------------- | --------------------------- | ----------------- | ------ |
| multi process | 많은 메모리 공간 / CPU 시간 | 느림              | 높음   |
| multi thread  | 적은 메모리 공간 / CPU 시간 | 빠름              | 낮음   |
|               |                             |                   |        |



## CPU 스케줄링

CPU 스케줄링이란 컴퓨터 시스템의 운영체제가 프로세스들 사이에서 CPU시간을 어떻게 할당할지 결정하는 과정 

### 장기 스케줄링

시스템에 새로운 프로세스가 들어올 시점을 결정한다. 

디스크에서 메모리로 언제 로드할 지 결정하며, 시스템의 동시 실행 가능한 프로세스 수를 제어한다. 

시스템의 다중 프로그래밍 수준을 조절하는 것이며, 너무 많은 프로세스가 메모리에 있지 않도록 하여 각 프로세스에 충분한 리소스가 할당되도록 한다.

### 중기 스케줄링

시스템의 성능을 최적화하기 위해 실행 중인 프로세스를 메모리와 디스크 사이에서 이동시킨다. 이 과정은 스왑핑이라고 하며, 시스템의 오버헤드를 줄이고, 메모리 사용을 더 효율적으로 만들기 위해 사용됨. 

시스템의 부하를 줄이고, 필요한 경우 메모리를 확보하기 위해 일부 프로세스를 중지시키는 역할을 한다. 

### 단기 스케줄링

메모리에 있는 프로세스들 중 어떤 프로세스가 다음에 CPU 시간을 받을 지 결정한다. 이 스케줄러는 매우 빈번하게 실행되며, 프로세스들 사이의 실행 순서를 결정해, 시스템의 반응 시간, 처리량, CPU 사용률을 최적화 한다. 

다양한 알고리즘을 사용할 수 있으며, 각 알고리즘은 특정 시스템 요구 사항에 맞게 설계된다.

## 스케줄링 알고리즘

### FCFS(First Come First Served)

준비 큐에 도착한 순서대로 CPU를 할당하는 비선점형 번식으로, 선입선출 스케줄링 이라고도 한다. 

비선점형 방식이기 때문에 한 번 실행되면 그 프로세스가 끝나야만 다음 프로세스를 실행 할 수 있다.

큐가 하나이기 때문에 모든 프로세스의 우선순위가 동일하다.

**단점**

- 콘보이 효과 : 처리 시간이 긴 프로세스가 CPU를 차지하면 다른 프로세스들은 기다려야 함.
- 현재 작업 중인 프로세스가 입출력 작업을 요청하는 경우 CPU가 작업하지 않고, 쉬는 시간이 많아져 작업 효율이 떨어짐

### SJF(Shortest Job First)

준비 큐에 있는 프로세스 중에서 실행 시간이 가장 짧은 작업부터 CPU를 할당하는 비선점형 방식으로 최단 작업 우선 스케줄링이라고도 한다. 

SJF 스케줄링에서는 프로세스에 CPU를 배정할 때 시간이 오래 걸리는 작업이 앞에 있고 간단한 작업이 뒤에 있으면 그 순서를 바꾸어 실행한다.

**사용하기 어려운 이유**

- 운영체제가 프로세스의 종료 시간을 정확하게 예측하기가 어렵다. 
  - 워드 프로세스를 사용 시 몇 분을 사용할 수 있지만, 몇 시간을 사용할 수도 있다.
  - 키보드의 입력을 기다리는 경우도 마찬가지
- SJF 알고리즘은 **공평성**에 위배된다.
  - 아사현상 / 무한봉쇄 현상
    - 작업 시간이 짧은 프로세스가 들어오면, 작업 시간이 긴 프로세스는 무한정 기다려야하는 현상

### Round Robin

한 프로세스가 할당받은 시간(타임 슬라이스)동안 작업을 하다가 완료하지 못하면 준비 큐의 맨 뒤로 가서 자기 차례를 기다리는 방식

라운드 로빈 스케줄링은 우선순위가 적용되지 않은 가장 단순한 선점형 스케줄링 방식

### SRT(Shortest Remaining Time)

SJF 스케줄링과 Round Robin 스케줄링을 혼합한 방식으로 최소 잔류 시간 우선 스케줄링이라고도 한다.

이 방식은 SJF 스케줄링의 선점형 버전이라고 할 수 있다. 

기본적으로 Round Robin 스케줄링을 사용하지만, CPU를 할당받을 프로세스를 선택할 때 남은 작업 시간이 가장 적은 프로세스를 선택한다. 

**사용하기 어려운 이유** 

- 추가적인 계산 로직
  - 현재 실행 중인 프로세스와 큐에 있는 프로세스의 남은 시간을 주기적으로 계산하고, 남은 시간이 더 적은 프로세스와 Context Switching
- 운영체제가 프로세스의 종료 시간을 예측하기 어렵다
- 아사 현상이 일어난다.

### Priority scheduling(우선순위 스케줄링)

프로세스는 중요도에 따라 우선순위를 갖는데, 이러한 우선순위를 반영한 스케줄링 알고리즘

- 준비 큐에 있는 프로세스의 순서를 무시하고, 우선순위가 높은 프로세스에 먼저 CPU를 할당하므로 공평성을 위배하고 아사현상을 일으킨다는 문제가 존재함
- 프로세스의 우선순위를 매번 바꿔야 하기 때문에 오버헤드가 발생해 시스템의 효율성이 떨어짐

### Multilevel Queue(다단계 큐)

우선순위에 따라 준비 큐를 여러 개 사용하는 방식

다단계 큐에서는 우선순위에 따라 다단계로 나뉘며, 각각의 큐는 라운드 로빈으로 운영된다. 

우선순위는 고정형 우선순위를 사용하며, 상단 큐에 있는 모든 프로세스의 작업이 끝나야 다음 우선순위 큐의 작업이 시작된다. 

*다단계 큐 스케줄리에서는 우선순위가 높은 상위 큐 프로세스의 작업이 끝나기 전에 하위 큐 프로세스의 작업을 할 수 없다.*

### Multilevel Feedback Queue

우선순위가 낮은 프로세스에 불리한 다단계 큐 스케줄링의 문제점을 보완한 방식.

다단계 피드백 큐의 경우 **CPU를 사용한 후 프로세스의 우선순위가 낮아진다.** CPU를 사용한 후의 프로세스는 원래의 큐로 돌아가지 않고 우선순위가 하나 낮은 큐의 끝으로 들어간다. 

*물론 프로세스의 우선순위가 낮아진다고 할지라도, 커널 프로세스가 일반 프로세스의 큐에 삽입되지는 않는다.*

**우선순위에 따라 타임 슬라이스의 크기가 다르다.**

## 인터럽트

### 인터럽트 개념

- 프로그램 실행 중 발생하는 이벤트로, 현재 실행 중인 작업을 일시 중단하고, 인터럽트 요청을 처리한 후 원래 작업으로 돌아가게 하는 메커니즘
- 시스템의 효율성을 증가시키고, 입출력 장치와의 비동기적 통신을 가능하게 함
- 하드웨어 인터럽트와 소프트웨어 인터럽트 두가지 유형이 있다.

### 동기적 인터럽트, 비동기적 인터럽트

- 동기적 인터럽트
  - 프로그램의 실행에 의해 명시적으로 발생하는 인터럽트.
  - ex) 잘못된 명령어 실행, 잘못된 메모리 접근 .. 
- 비동기적 인터럽트
  - 외부 이벤트에 의해 발생하는 인터럽트.
  - 예측할 수 없는 시점에 발생
  - ex) 키보드 입력, 타이머 인터럽트 .. 

### 인터럽트 처리 과정

1. 인터럽트 요청이 발생하면 현재 실행 중인 작업을 일시 중단한다.
2. 시스템은 인터럽트 요청을 확인하고, 인터럽트 벡터를 사용해 해당 인터럽트를 처리할 서비스 루틴의 주소를 찾는다.
3. 인터럽트 서비스 루틴이 실행되어 인터럽트를 처리한다.
4. 인터럽트 처리가 완료되면, 중단되었던 원래 작업 혹은 다른 준비상태에 있는 작업으로 복귀해 실행을 계속한다. 

### 인터럽트와 이중 모드

- 이중 모드 운영
  - 시스템은 사용자 모드와 커널 모드 두가지 모드를 가진다. 
  - 시스템의 보안과 안정성을 증가시키기 위함 
- 인터럽트 발생 시, 시스템은 사용자 모드에서 커널 모드로 전환해 인터럽트를 처리한다.
  - 커널 모드에서만 실행할 수 있는 인터럽트 서비스 루틴을 안전하게 실행하기 위함
- 인터럽트 처리가 완료되고 사용자 모드로 복귀할 때, 시스템은 다시 사용자 모드의 권한으로 실행을 계속한다. 