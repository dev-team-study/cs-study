## JPA

### JDBC, Spring JDBC

JDBC, Spring JDBC 모두 Java 애플리케이션에서 데이터베이스에 접근하고 조작하는 방법을 제공한다. 

**JDBC**

JDBC는 Java에서 데이터베이스에 접근하기 위한 표준 API. 

직접 데이터베이스와 연결을 맺고, SQL 쿼리를 실행하며, 결과를 처리하는 기본적인 메커니즘을 제공.

JDBC 사용시, 개발자는 다음과 같은 작업을 수행해야함

- 데이터베이스 연결을 위한 드라이버 로드
- Connection 객체를 통해 데이터베이스 연결
- SQL 쿼리를 실행하기 위한 Statement 또는 PreparedStatement 객체 생성 
- 쿼리 실행 및 ResultSet 객체를 통한 결과 처리 
- 예외 처리와 리소스의 명시적 해제

**Spring JDBC**

Spring framework의 일부로, JDBC의 복잡성을 추상화하고 단순화해 개발자가 데이터베이스 작업을 더 쉽게 할 수 있도록 도와줌. 다음과 같은 이점들을 제공한다. 

- 리소스 관리 : Spring은 자동으로 데이터베이스 연결, SQL 쿼리, ResultSet을 관리하고 닫아줌. -> 코드에서 많은 부분을 줄여주며, 리소스 누수를 방지할 수 있다.
- 예외 처리 : Spring 은 Checked Exception을 Runtime Exception으로 변환해, 예외 처리 코드를 단순화해준다. 
- 다양한 지원 클래스와 Template : Spring은 JdbcTemplate, NamedParameterJdbcTemplate 등 다양한 템플릿과 헬퍼 클래스를 제공해, 반복적인 코드를 줄이고, 데이터베이스 작업을 도 효율적으로 만든다.

### Sql Mapper(MyBatis), ORM

Sql Mapper와 ORM은 데이터베이스와 Java Application에서 데이터베이스 작업을 추상화하고 단순화하지만 접근 방식과 제공하는 추상화 수준에 차이가 존재한다. 

**Sql Mapper**

SQL 쿼리를 객체에 매핑하는 방식으로 작동한다.

개발자가 SQL 쿼리를 직접 작성하고, SQL Mapper가 이 쿼리를 실행한 후 결과를 애플리케이션의 객체로 매핑한다. 

**장점**

- 높은 제어 수준 : 개발자는 세밀한 SQL 쿼리 최적화가 가능하다.
- 유연성 : 복잡한 쿼리와 고급 데이터베이스 기능을 사용할 수 있다.

**단점**

- 반복적인 매핑 코드 : 결과를 객체에 매핑하는 과정에서 반복적인 코드가 필요할 수 있다. 
- SQL 지식 필요 : 데이터베이스 작업을 수행하기 위해 SQL에 대한 깊은 이해가 필요

**ORM (Obejct Relational Mapping)**

데이터베이스의 테이블과 Application 객체 사이의 관계를 매핑함으로써, 객체 지향 프로그래밍 언어를 사용해 데이터베이스를 관리할 수 있도록 해준다. ORM의 대표적인 예로써 Hibernate, EclipseLink, JPA가 있다. 

**장점**

- 개발 생산성 : SQL 쿼리 없이객체를 통해 데이터베이스 작업을 수행할 수 있다. 
- 데이터베이스 독립성 : 다양한 데이터베이스 시스템으로 쉽게 변경할 수 있다. 

**단점**

- 성능 고려 : ORM의 자동화된 쿼리는 때로 최적화가 필요한 복잡한 쿼리보다 비효율적일 수 있다. 
- 학습 곡선 : ORM을 효과적으로 사용하기 위해선 학습이 필요하다. 

### @Transactional

선언적 트랜잭션 관리 방법이다.  해당 어노테이션을 클래스 혹은 메서드에 적용함으로 인해 해당 범위의 코드를 하나의 트랜잭션으로 묶어 실행할 수 있다. 

**특징**

- 자동 롤백 : 트랜잭션 내에서 예외가 발생하면, Spring은 자동으로 트랜잭션을 롤백한다. 
- 전파 행위 지정 : 트랜잭션의 전파행위를 지정할 수 있다. 
- 격리 수준 설정 : 데이터베이스의 트랜잭션 격리 수준을 설정할 수 있다.
- 읽기 전용 설정 : 트랜잭션을 읽기 전용으로 설정할 수 있다. (데이터 변경이 없는 작업에 한해 성능 최적화에 도움을 줄 수 있다.)
- 타임아웃 설정 : 트랜잭션이 너무 오래 실행되는 것을 방지하기 위해 타임아웃 설정을 할 수 있다. 

### JPA, Hibernate

JPA, Hibrenate는 Java 기반의 데이터 지속성을 관리하는데 사용되는 기술 

JPA (Java Persistence API)

- 정의 
  - JPA는 Java EE 플랫폼의 일부로, 객체-관계 매핑을 위한 표준 API를 제공한다. 
  - JPA는 ORM을 구현하기 위한 명세이며, 실제 구현은 JPA Provider에 의해 이루어진다.
- 목적 
  - JPA는 데이터베이스 테이블과, Java 객체 간의 매핑을 정의하고, 데이터베이스 작업을 위한 표준 API를 제공한다.
- 구현체
  - JPA는 명세이기 때문에, Hibernate, EclipseLink, OpenJPA 등과 같은 여러 구현체가 존재한다.

Hibernate

- 정의 
  - Hiberantesms JPA의 가장 유명한 구현체 중 하나로, 객체-데이터베이스 관계 매핑을 위한 프레임워크이다.
- 기능
  - Hibernate는 데이터베이스와 객체 지향 프로그래밍 사이의 불일치 문제를 해결하기 위해 설계되었다.
- 확장성
  - Hibernatesms JPA명세를 넘어서는 다양한 추가 기능과 성능 최적화 옵션을 제공한다. 

### 영속성 컨텍스트

영속성 컨텍스트는 일종의 버퍼 역할을 하며, 애플리케이션과 데이터베이스 사이에서 엔티티의 생명 주기를 관리한다.

- 엔티티 생명주기 관리
  - 영속성 컨텍스트는 엔티티 객체의 생명주기를 관리한다. 
  - 상태는 new, managed, detached, removed 
- 1차 캐시
  - 엔티티 매니저를 통해 조회 또는 변경된 엔티티는 먼저 영속성 컨텍스트에 저장된다. 
  - 이후 같은 엔티티에 대한 조회 요청이 있을 때에는 데이터베이스에 접근하지 않고 1차 캐시에서 엔티티를 반환한다.
- 변경 감지 
  - 영속성 컨텍스트는 엔티티의 변경을 추적한다.
  - 트랜잭션을 커밋할 때, 영속성 컨텍스트는 1차 캐시에 있는 엔티티와 데이터베이스의 상태를 비교해 변경된 사항이 있는 지확인한다.
  - 변경이 감지되면, 이를 데이터베이스에 자동으로 반영한다.
- 지연 로딩
  - 영속성 컨텍스트는 필요할 때 까지 엔티티의 로딩을 지연시킬 수 있다. 
  - ex) 연관된 엔티티를 즉시 로드하지 않고, 실제로 사용 될 때 로드하는 방식.
- 트랜잭션 범위 내에서의 일관성
  - 영속성 컨텍스트는 하나의 트랜잭션 범위 안에서 엔티티에 대한 일관성을 보장한다.
  - 같은 트랜잭션 내에서는 같은 엔티티 인스턴스에 대해 동일한 데이터 뷰를 유지한다. 

### 즉시/지연 로딩

JPA에서 관계를 가진 엔티티를 로드하는 두가지 전략이다.

즉시 로딩 

- 정의 
  - 엔티티를 로드할 때, 관련된 모든 연관 엔티티나 컬렉션도 함께 즉시 로드하는 전략.
- 동작
  - User 엔티티에 Order 엔티티가 연관되어 있다면, User 엔티티 로드시 연관된 Order 엔티티도 동시에 로드 된다.
- 장점
  - 연관된 데이터가 필요한 경우, 추가적인 쿼리 없이 바로 사용할 수 있다.
- 단점
  - 필요하지 않은 데이터까지 로드 할 수 있어 성능에 부정적인 영향을 미칠 수 있다.
  - 특히 연관된 데이터가 많거나, 복잡한 경우, 성능 저하의 원인이 될 수 있다.

지연로딩

- 정의 
  - 엔티티를 로드할 때, 연관된 에티티나 컬렉션을 실제로 사용할 때 까지 로드하지 않는 전략
- 동작
  - 위 예시에서 User 엔티티 조회시 Order 엔티티는 로드하지 않는다.
  - Order 데이터에 접근하는 시점에 해당 데이터를 로드하는 쿼리가 실행된다.
- 장점
  - 필요한 시점에만 데이터를 로드하므로 초기 로드 시간을 줄이고, 자원을 효율적으로 사용할 수 있다.
- 단점
  - 실제 데이터에 접근 할 때 마다 추가적인 쿼리가 발생할 수 있으므로, 네트워크 지연이나 쿼리 오버헤드가 발생할 수 있다.

### 프록시

A에서 프록시는 실제 엔티티 객체를 상속받아 생성된 객체로, 실제 엔티티의 참조를 지연 로딩 방식으로 관리하기 위해 사용된다. 프록시는 데이터베이스의 실제 데이터를 담고 있는 것 처럼 동작하지만, 실제로는 필요한 시점까지 데이터를 로드하지 않는다.

- 지연 로딩
  - 프록시는 주로 지연 로딩 설정이 있는 관계에서 사용된다.
  - JPA는 엔티티의 연관된 객체를 즉시 로드하지 않고, 프록시 객체를 반환해 해당 객체가 실제로 사용될 때 까지 로드를 지연시킨다.
- 프록시 객체의 초기화
  - 프록시 객체에 처음 접근할 때, JPA는 데이터베이스에서 실제 엔티티 데이터를 로드하고 프록시 객체를 초기화 한다.
  - 이후 프록시 객체는 실제 엔티티처럼 동작하며, 실제 엔티티 데이터에 접근할 수 있다.
- 투명성
  - 프록시 객체는 실제 엔티티를 상속받기 때문에, 프록시 객체를 실제 엔티티와 동일하게 사용할 수 있다.
- 프록시의 특징
  - 프록시 객체는 처음 사용될 때 한번 초기화 된다. 
  - 초기화 이후에는 해당 프록시 인스턴스를 통해 여러번 데이터에 접근할 수 있다.
  - 프록시 객체는 엔티티와 동일한 식별자를 가진다.
- 주의사항
  - 프록시 객체는 영속성 컨텍스트가 활성화된 상태에서만 올바르게 초기화 된다.
  - 영속성 컨텍스트가 종료되거나 분리된 상태에서 프록시를 초기화 하고자 한다면 예외가 발생할 수 있다. 