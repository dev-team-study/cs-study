
# XSS
- SQL Injection과 함께 웹 상에서 가장 기초적인 취약점 공격 방법중 하나
- 권한이 없는 사용자가 악의적인 용도로 웹 사이트에 스크립트를 삽입하는 공격 기법을 의미
- 다른 웹사이트와 정보를 교환하는 식으로 작동하므로 사이트 간 스크립팅이라고 부름

## XSS 종류
### Reflected XSS
- 공격자가 악성 스크립트를 클라이언트에게 직접 전달하여 공격하는 방식
- URL에 스크립트를 포함시켜 공격하는 경우가 대표적

### Reflected XSS 공격 시나리오
- 악의적인 사용자가 보안이 취약한 사이트를 발견
- 보안이 취약한 사이트에서 사용자 정보를 빼돌릴 수 있는 스크립트가 담긴 URL을 만들어 일반 사용자에게 스팸 메일로 전달
- 일반 사용자는 메일을 통해 전달받은 URL 링크를 클릭합니다. 일반 사용자 브라우저에서 보안이 취약한 사이트로 요청을 전달
- 일반 사용자의 브라우저에서 응답 메세지를 실행하면서 악성 스크립트가 실행
- 악성 스크립트를 통해 사용자 정보가 악의적인 사용자에게 전달

### Stored XSS
- 공격자가 악성 스크립트를 서버에 저장시킨 다음 클라이언트의 요청/응답 과정을 통해 공격하는 방식

### Stored XSS 공격 시나리오
- 악의적인 사용자가 보안이 취약한 사이트를 발견
- 보안이 취약한 사이트에서 제공하는 게시판에 사용자 정보를 빼돌릴 수 있는 스크립트를 작성하여 올림
- 일반 사용자는 악의적인 사용자가 작성한 게시글을 읽으면, 서버로부터 악성 스크립트가 담긴 게시글 응답을 전달받음
- 일반 사용자의 브라우저에서 응답 메세지를 실행하면서 악성 스크립트가 실행
- 악성 스크립트를 통해 사용자 정보가 악의적인 사용자에게 전달

### XSS 방어 방법 
1. 입력 값에 특수 문자를 넣지 못하게 방지
2. 사용자의 입력 값을 그대로 출력 금지

# SQL Injection
- 임의의 SQL 문을 주입하고 실행되게 하여 데이터베이스가 비정상적인 동작을 하도록 조작하는 행위

## 공격 종류 및 방법
### 논리적 에러를 이용한 SQL Injection
- 가장 많이 쓰이고, 대중적인 공격 기법
```sql
# 기본 쿼리문
SELECT * FROM users WHERE id = 'input1' AND password = 'input2';

# 악의적인 쿼리
SELECT * FROM users WHERE id = '' OR 1=1 -- AND password = 'input2';

```
- 로그인 시 ID에 ' OR 1=1 -- 를 입력하여 쿼리를 전부 무효화 시키는 방법 
- 악의적인 쿼리를 날릴시 모든 유저의 정보를 가져올 수 있음

## 대응 방법
### 1. 입력 값에 대한 검증
- 입력 값에 대한 검증을 하여 이상한 값이 들어오지 않는지 확인

### 2. Prepared Statement 구문 사용
- 사용자의 입력이 쿼리문으로 들어가는 것이 아닌 문자열로 변경되어 들어가기 때문에 아무 의미 없는 값이 됨
- Native Query를 이용하는 것은 큰 위험성이 따를 수 있음.

# cookie
- HTTP 쿠키는 서버가 사용자의 웹 브라우저에 전송하는 작은 데이터 조각
- 브라우저는 그 데이터 조각들을 저장해 놓았다가, 동일한 서버에 재 요청시 저장된 데이터를 함께 전송

## cookie의 주 목적 3가지
### 세션 관리
- 서버에 저장해야 할 로그인, 장바구니, 게임 스코어 등의 정보 관리

### 개인화
- 사용자 선호, 테마 등의 세팅

### 트래킹
- 사용자의 행동을 기록하고 분석하는 용도
  
모든 요청마다 쿠키가 저장되기 때문에 요즘은 LocalStorage나 SessionStorage를 이용

## 쿠키 만드는 방법
- 서버에서 응답할 때 Set-Cookie를 헤더에 추가하여 응답

## Secure과 HttpOnly 쿠키
- Secure 쿠키는 HTTPS 프로토콜에서 암호화된 요청일 경우에만 전송
- HttpOnly를 이용해서 클라이언트에서 자바스크립트로 cookie에 접근 불가능(XSS 방지)

# session
- 웹 사이트의 여러 페이지에 걸쳐 사용되는 사용자 정보를 저장하는 방법을 의미
  - 클라이언트와 서버 간의 연결 상태를 의미하는 것이기도 함
- 브라우저를 열어 사용자가 브라우저를 닫는 시점까지를 세션이라고 표현
- 세션은 서버 측에 세션 데이터를 저장하고, 세션의 키 값만을 클라이언트 측에 남겨둠
- 보안에 취약한 쿠키를 보완해주는 역할을 함.

# JWT
- Json 형태 데이터를 이용한 클레임 기반의 토큰 인증 방식

## JWT 인증 방식
1. 클라이언트가 인증 서버에 토큰 요청
2. 토큰 요청을 받은 인증 서버는 사용자 계정을 확인하고 토큰 지급이 가능한지 여부를 판정 후 토큰 발급
3. 인증 서버는 사용자 정보를 Json 데이터로 만들고, 이를 암호화하여 토큰 생성
   - 토큰은 스토리지에 저장 X
4. 인증 서버는 클라이언트에게 토큰을 전달
5. 클라이언트는 토큰과 함께 리소스 서버에 API 요청을 수행
6. 리소스 서버는 토큰을 이용한 사용자의 권한 정보 등을 확인 후 응답

## JWT 구조

### 헤더 정보
- 토큰 유형이나, 해시 알고리즘 종류 정보가 담김
- BASE64URL로 인코딩

### 페이로드 정보
- 페이로드에 담는 정보의 한 조각을 클레임이라고 부름(이름-값 쌍으로 이루어짐)
- 등록된 클레임, 공개된 클레임, 비공개 클레임으로 분류

#### 등록된 클레임
- 토큰 발급자, 토큰 만료 시간 등

#### 공개된 클레임
- JWT를 사용하는 사람들에 의해 정의되는 클레임

#### 비공개 클레임
- 등록된 클레임도 아니고, 공개된 클레임도 아닌 클라이언트와 서버 협의하에 사용되는 클레임의 이름들

### 시그니처
- 헤더와 페이로드의 데이터 무결성과 변조 방지를 위한 서명 정보
- 헤더 정보 + 페이로드 정보를 비밀 키로 해싱하여 생성한 값
