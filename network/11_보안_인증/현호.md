```
- 보안
  - XSS
  - SQL Injection
- 인증
  - cookie
  - session
  - JWT
```

# 보안
## XSS
- SQL injection과 함께 웹 상에서 가장 기초적인 취약점 공격 방법중 하나로, 권한이 없는 사용자가 악의적인 용도로 웹 사이트에 스크립트를 삽입하는 공격 기법을 말합니다.

- XSS는 웹 애플리케이션이 사용자로부터 입력 받은 값을 제대로 검사하지 않고 사용할 경우 나타나며, 공격에 성공하면 사이트에 접속한 사용자는 삽입된 코드를 실행하게 되어, 의도치 않은 행동을 수행시키거나 쿠키나 세션 토큰 등의 민감한 정보를 탈취합니다.

- XSS는 자바스크립트를 사용하여 공격하는 경우가 가장 많고, 사용자의 세션을 공격자의 서버로 전송해서 탈취하거나 악성코드가 있는 페이지로 리다이렉트 시키는 방식으로 공격이 주로 행해집니다.
### 종류
- Reflected XSS

사용자의 입력창에 스크립트 코드를 입력해둔 뒤 사용자가 요청할 때 공격이 수행되는 기법
- Stored XSS

가장 일반적인 XSS공격 유형. 게시글 등에 정상적 평문이 아닌 스크립트 코드를 입력해두는 기법. 사용자가 게시물을 열람시, 공격자가 입력해놓은 악성 스크립트가 실행되어 사용자의 쿠키 정보가 유출되거나, 악성 스크립트가 기획한 공격에 당함.
저장된(지속적) XSS공격은 공격자가 웹 애플리케이션을 속여 데이터베이스에 악성코드를 저장하도록 하는 수법임. 따라서 애플리케이션 이용자 상당수에게 악성코드를 전송할 수 있음.
## SQL Injection
- SQL Injection 이란 악의적인 사용자가 임의의 SQL 문을 주입하고 실행되게 하여 데이터베이스가 비정상적인 동작을 하도록 조작하는 행위입니다. 보통 사용자 입력을 서버에서 검증하지 않고 SQL문에 직접 넣을 경우 해당 입력에 악의적인 SQL 구문을 삽입하여 발생됩니다.

### 예방 방법
- 사용자 입력에 SQL문에 사용되는 특수문자가 포함되어 있는지 검사하여 허용되지 않은 입력에 대해 예외 처리한다.
- SQL 서버의 에러 메시지를 사용자에게 보여주지 않도록 설정한다. 에러 메세지를 통해 DB 스키마를 분석해서 SQL 인젝션 스트링을 만들 수 있기 때문.
- 웹 어플리케이션이 사용하는 DB권한을 제한한다. 어플리케이션이 DDL문은 이용하지 못 하게하는 등의 방법을 쓰면, 제한적으로나마 인젝션 공격을 예방할 수 있다.

### prepared statement의 개념
사용자가 입력한 값을 쿼리에 직접 삽입하지 않고, 대신 매개변수가 제외된 쿼리를 분석해 최척화 수행 후 캐싱해 두고, 다음 요청 부터는 캐싱된 결과와 매개변수를 사용하여 쿼리를 수행하는 방식이다. 이 때 매개변수는 SQL문이 아닌 순수한 문자열로 인식되어 SQL인젝션에 대한 방어가 가능하다. 여러 번 재사용이 일어나는 상황에서 성능적인 효율이 높다는 장점도 있다. 참고로 일반 statememnt 방식은 실행시마다 매 번 쿼리를 분석하는 방식이라 효율이 낮고, SQL Injection공격에 취약하다.
### prepared statement를 통해 sql injection을 막을 수 있는 이유.
최초에 SQL문을 분석할 때 매개변수 부분은 제외하고 캐싱해둔다. 이후 매개변수로 바인딩될 데이터가 넘어와도 해당 문자열은 SQL문의 일부가 아닌 매개 변수로 처리되기 때문에 인젝션 공격을 막을 수 있다.


# 인증

## cookie
- 쿠키는 클라이언트에 저장되는 키와 값이 들어있는 작은 데이터 파일이다. 사용자가 웹사이트를 방문할 때, 웹 서버는 사용자의 브라우저에 이 쿠키를 저장한다. 이후 사용자가 같은 웹사이트를 방문하면 브라우저는 쿠키를 웹 서버에 보내 사용자를 식별한다. 쿠키는 사용자의 로그인 정보, 방문한 사이트의 정보 등을 저장할 수 있지만, 보안에 취약하고 용량이 제한적이라는 단점이 있다.
## session
- 세션은 서버 측에서 관리되는 사용자 정보이다. 세션 ID를 이용하여 사용자를 식별하고, 이 ID는 쿠키를 통해 클라이언트에게 전달된다. 세션은 쿠키보다 보안성이 높지만, 사용자가 많아지면 서버의 부하가 증가하는 단점이 있다.
- 서버가 세션 관리의 주체가 되기에 서비스가 커질 수록 고려해야할 부분이 많아진다. (ex.스케일 아웃 환경, 세션 저장소에 문제가 생기는 경우에 대한 대비 등)

### session 불일치 문제
서버를 여러대로 늘리면 각 서버에 로드밸런싱으로 트래픽을 분산하게 한다. 그래서 서버 한대에 장애가 생겨도 다른 서버는 살아있으니 서비스 문제가 생기지 않는다.
그러나 이때 서비스 이용에 발생하는 커다란 문제점이 있는데 바로 데이터 정합성, 세션 불일치 문제다.
왜냐하면 여러 대의 서버가 각각 세션 저장소를 독립적으로 갖기 때문에 데이터 불일치 문제가 발생하기 때문이다.

### session 불일치 해결
- Sticky Session 방식: 쿠키에 로그인 서버 정보를 넘겨주어, 클라이언트가 특정 서버로만 요청을 보내도록 하여 해결.
- Session 클러스터링 방식: 각 서버의 세션 저장소가 서로 값을 전파하도록 하여 모든 세션 저장소가 같은 상태를 유지하도록하여 해결.
- Session Storage 방식 : 세션 저장소를 외부에 생성하여 각 서버들이 외부의 세션 저장소를 공유하도록 구성.



## JWT
토큰(Token)은 사용자의 인증 정보를 암호화한 문자열이다. 사용자가 로그인하면 서버는 토큰을 발급하고, 이후 사용자는 이 토큰을 통해 인증 및 권한 부여를 받는다. 토큰은 클라이언트나 서버 어디에도 저장되지 않고 필요할 때마다 서버에 전달된다. 토큰은 쿠키나 세션보다 높은 보안성을 가지지만, 토큰이 탈취되면 보안 문제가 발생할 수 있다는 점이 있다.

헤더: 토큰의 유형과 해싱 알고리즘 정보를 포함한다.

페이로드: 실제 전달하고자 하는 데이터가 들어있다. 여기에는 사용자 ID, 권한 정보 등이 포함될 수 있다.

시그니처: 헤더와 페이로드를 암호화한 값이다. 이 값을 통해 토큰의 무결성을 확인할 수 있다.


# 질문
1. XSS의 정의와 종류별 공격방식을 설명해주세요.

2. SQL인젝션을 예방할 수 있는 방법들을 생각나는 대로 말씀해주세요.

3. prepared statement를 통해 SQL인젝션을 예방할 수 있는 이유를 말씀해주세요.

4. 쿠키/세션/JWT의 정의를 설명해주세요.

5. 다중 서버환경에서 세션을 저장해야할 때, 세션 저장소를 외부에 구성하는 방법 외에도 세션을 관리할 수 있는 방법이 있을까요?  
