# 면스

```
Web Server
apache vs nginx (동작원리)
SSL offloading
reverse proxy
load balancing
L7 vs L4
알고리즘
```

# Web Server

## apache vs nginx (동작원리)

- Apache 는 클라이언트의 요청이 들어오면 서버 Connection 을 생성한다. 즉 요청마다 Thread 을 만들어서 처리한다. 대량의 클라이언트(1만 이상) 가 동시에 서버 Connection 을 맺는다면 CPU/메모리 사용이 증가하고 프로세스/쓰레드 생성 비용이 드는 등 요청에 한계가 존재한다. 요청이 10,000개가 넘어가면 문제가 생길 수 있다는 의미로 C10k 문제라 부르기도 한다.
- NGINX는 **Apache Server 처럼 클라이언트의 요청마다 thread 을 생성하는게 아니라 `Worker Process` 즉, 단일 thread 을 이용하여 자원의 효율성을 보장한다. 이때문에 적은 메모리 사용 & CPU 사용을 보장한다.**
- **NGINX는 이벤트 기반 방식이다. EventHandler를 통해 비동기 방식으로 여러 connection을 처리한다. 이로 인해 apache에 비해 자원의 효율성이 좋으며, 요청 처리 효율도 좋다.**

## SSL offloading

- SSL 통신을 위해 Client 와 Server 사이에는 SSL handshaking 작업이 필요하다. 해당 작업이 WAS에서 일어나면 이외에도 해야할 작업이 많은 WAS에게 부담이 될 수 있다. 따라서 이 작업을 Web Server가 담당하도록 작업을 처리하는 계층을 한 단계 내려주는 것이 SSL offloading이다.
- SSL offloading이 일어나면, 웹 서버가 더이상 SSL 암호화/복호화에 신경쓰지 않게 되어 해당 자원을 다른 작업에 사용할 수 있게 된다.
- 웹 서버(Proxy 서버)를 거친 데이터는 복호화되어 HTTP 통신을 하게 되므로. 내부 통신망 안에서는 HTTPS를 사용해 통신하는 것 보다 빠른 속도로 통신하게 된다.

## reverse proxy

- ****Forward Proxy vs. R****everse proxy : 포워드 프록시는 프록시 서버가 앞 단의에 클라이언트 서버를 위해 존재함을, 리버스 프록시는 뒷 단의 서버를 위해 존재함을 의미한다.
- ****R****everse proxy가 존재할 때. 클라이언트는 웹서비스에 접근할 때 웹서버에 요청하는 것이 아닌, 프록시로 요청하게 되고, 프록시가 배후(reverse)의 WAS로부터 데이터를 가져오는 방식이다.
- WAS는 DB서버와 연결되어 있으므로, 외부 네트워크로 WAS가 노출되어 해킹당할 경우 DB서버까지 해킹당할 수 있는 문제가 발생할 수 있기 때문이다.
  따라서 리버스 프록시 서버를 DMZ에 두고 실제 서비스 서버는 내부망에 위치시킨 후 서비스 하는 것이 일반적이다.

## load balancing

- 리버스 프록시를 두었을 때 누릴 수 있는 대표적인 이점이다. 유명한 웹 사이트는 하루에도 수백만명이 방문한다. 그리고 그러한 대량의 트래픽을 하나의 싱글 서버로 감당해 내기란 어렵다. 하지만 리버스 프록시 서버를 여러개의 본 서버들 앞에 두면 특정 서버가 과부화 되지 않게 로드밸런싱이 가능하다.

### L7 vs L4

- **L4 로드 밸런서는 전송 계층(Transport Layer, Layer 4)** 에서 작동하는 로드 밸런서로, 주로 TCP 및 UDP 프로토콜을 기반으로 클라이언트와 서버 간의 트래픽을 분산시킵니다. L4 로드 밸런서의 장점은 처리 속도가 빠르다는 것입니다. 패킷의 헤더 정보만을 이용하기 때문에 빠른 응답 시간을 제공합니다. 단점은 애플리케이션 계층의 정보를 활용하지 못해 기능 및 유연성이 제한적이라는 점입니다.
- **L7 로드 밸런서는 애플리케이션 계층(Application Layer, Layer 7)** 에서 작동하는 로드 밸런서로, 주로 HTTP 및 HTTPS 프로토콜을 기반으로 클라이언트와 서버 간의 트래픽을 분산시킵니다. L7 로드 밸런서의 장점은 다양한 기능 및 유연성을 제공한다는 것입니다. 요청 내용을 분석하여 특정 요청을 특정 서버로 전달하거나, 캐싱 및 압축 등의 다양한 기능을 구현할 수 있습니다. 단점은 처리 속도가 상대적으로 느리다는 점입니다. 패킷의 애플리케이션 계층 정보를 분석해야 하기 때문에 L4 로드 밸런서보다 처리 시간이 더 걸립니다.
- L4와 L7 로드 밸런서는 각각의 장단점이 있기 때문에, 웹 서비스에서는 이 두 기술을 상황에 맞게 적절하게 활용해야 합니다. 예를 들어, 실시간 트래픽 처리가 중요한 서비스의 경우 L4 로드 밸런서를 사용하여 빠른 응답 시간을 제공할 수 있으며, 애플리케이션 레벨의 로드 밸런싱이 필요한 서비스에서는 L7 로드 밸런서를 사용하여 다양한 기능과 유연성을 활용할 수 있습니다. 따라서 웹 개발자는 L4와 L7 로드 밸런서의 원리와 사용 방법에 대해 정확하게 이해하고, 상황에 맞게 적절한 기술을 선택하여 사용할 필요가 있습니다.

### 알고리즘

- 라운드 로빈 방식: 클라이언트로부터 받은 요청을 로드밸런싱 대상 서버에 순서대로 할당받는 방식입니다. 첫 번째 요청은 첫 번째 서버, 두 번째 요청은 두 번째 서버, 세 번째 요청은 세 번째 서버에 할당합니다. 로드밸러닝 대상 서버의 성능이 동일하고 처리 시간이 짧은 애플리케이션의 경우, 균등하게 분산이 이루어지기 때문에 이 방식을 사용합니다.
- 가중 라운드 로빈 방식: 실제 서버에 서로 다른 처리 용량을 지정할 수 있습니다. 각 서버에 가중치를 부여할 수 있으며, 여기서 지정한 정숫값을 통해 처리 용량을 정합니다.
- 최소 연결 방식:연결 수가 가장 적은 서버에 네트워크 연결방향을 정합니다. 동적인 분산 알고리즘으로 각 서버에 대한 현재 연결 수를 동적으로 카운트할 수 있고, 동적으로 변하는 요청에 대한 부하를 분산시킬 수 있습니다.

## 질문

1. Apache와 NGINX의 주요 차이점은 무엇이며, NGINX가 Apache에 비해 어떤 이점을 가지고 있나요?
2. SSL offloading이 어떤 의미인지 설명해주세요.
3. Forward Proxy와 Reverse Proxy의 차이점에 대해 설명해주세요.
4. Reverse Proxy의 개념과 왜 웹 서버 아키텍처에서 이를 사용했을 때의 이점에 대해 설명해주세요.
5. (로드 밸런싱 답변 나왔을 경우) L4와 L7 로드 밸런서의 차이점은 무엇인가요?
6. 로드 밸런싱 알고리즘 중 라운드 로빈 방식과 가중 라운드 로빈 방식에 대해 설명하고, 어떤 상황에서 각각을 사용해야 하는지 예를 들어 설명해주세요.