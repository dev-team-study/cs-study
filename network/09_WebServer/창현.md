
# WebServer
HTTP 프로토콜을 기반으로 클라이언트가 웹 브라우저에서 어떠한 요청을 하면 그 요청을 받아 **정적 컨텐츠를 제공하는 서버**

## 1. apache vs nginx (동작원리)
### 1.1 apache
#### apache란
- Apache 웹 서버는 Apache HTTP Server를 줄여서 부르는 말로 웹서버 종류 중 하나이다.
- 멀티 스레드 기반
- 모듈을 동적으로 로드, 언로드 할 수 있음.

#### 동작원리
- 프로세스 기반 접근 방식으로 하나의 스레드가 하나의 요청을 처리하는 구조
- 매 요청마다 스레드를 생성 및 할당해야 하기 때문에 리소스를 많이 잡아 먹음
![apache](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcFcSPQ%2FbtrcB4KXbHM%2Fg4FqyuDKYEHLIxozKYHDn0%2Fimg.png)
- 프로세스가 blocking되면 완료될 때까지 대기했다가 처리
##### PreFork MPM(다중 프로세스)
- Client 요청에 대해 Apache 자식 프로세스를 생성하여 처리
##### Worker MPM(멀티 프로세스-스레드)
- Prefork보다 메모리 사용량이 적고, 동시 접속자가 많은 사이트에 적합
- 각 프로세스의 스레드를 생성해 처리하는 구조

### 1.2 nginx
#### nginx란
- Apache의 C10K의 문제점 해결을 위해 만들어진 경량화된 소프트웨어 웹 서버
    - C10K: 1만개의 클라이언트 문제 -> apache는 매번 프로세스를 만들어내서 한계가 있음
- 이벤트 처리 방식, 비동기식 처리, 논블로킹 처리 방식을 통해 고속으로 처리
- 동적 컨텐츠를 처리하지 않음
- 다른 코어 모듈을 로딩할 수 없음.

#### 동작원리
- 이벤트 중심 접근 방식으로 하나의 스레드 내에서 여러 요청을 처리하는 구조
- 비동기 Event-Driven 구조: Event Handler에서 비동기 방식으로 먼저 처리되는 요청을 진행
- 코어 모듈이 Apache보다 적은 리소스로도 많은 트래픽을 효율적으로 처리 가능
![nginx](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbAbGyw%2FbtrcGUADagZ%2FEvavl3JpiSZbPq9T3Hzm01%2Fimg.png)

### 1.3 어떨 때 어떤 것을 사용해야할까
NGINX - 동시 접속이나 대용량 서비스 처리면에서 정적 콘텐츠를 서비스해야 하는 경우
APACHE - 대규모 접속이 아닌데 안정성이 중요한 경우

## SSL offloading
- SSL 통신을 하기 위해서 서버와 클라이언트 사이에 알게 모르게 많은 과정들을 거치게 되는데 API 서버 군 앞에 Proxy 서버를 두고 해당 Proxy 서버에 SSL 관련 작업을 위임
- Proxy 서버를 거친 데이터는 복호화되어 HTTP 통신을 하게 됨

### SSL offloading을 통한 이점
- 웹 서버가 더 이상 SSL 암호화, 복호화에 신경쓰지 않게 되어 해당 리소스를 다른 작업에 사용할 수 있음
- 웹 서버의 속도를 높여줌으로써 사용중인 웹서버의 수를 늘리지 않고 웹사이트가 클라이언트 요청을 더욱 잘 처리

## reverse proxy
- 클라이언트의 요청을 받아 내부 서버로 전달해주는 것을 의미

### 리버스 프록시의 장점
- 로드 밸런싱: 클라이언트의 요청을 받아 로드 밸런싱을 수행하여 확장성 및 신뢰성 향상
- 캐싱: 미리 렌더링된 버전의 페이지를 캐시해서 페이지 로드 시간을 단축
- SSL Termination: 수신 SSL 연결을 처리 및 해독하고 프록시 서버의 응답을 암호화
- 보안: 서버의 IP를 숨길 수 있음

## load balancing
- 로드 밸런싱이란 말 그대로 서버가 처리해야 할 업무 혹은 요청을 여러 대의 서버로 나누어서 처리하는 것을 의미
- Scale-out 방식에 사용됨

 ### 알고리즘
 - 라운드 로빈 방식
   - 서버에 들어온 요청을 순서대로 돌아가며 배정하는 방식
   - 요청을 순서대로 분배하기 때문에 여러 대의 서버가 동일한 스펙을 가지고 있고, 
 - 가중 라운드로빈 방식
   - 각각의 서버마다 가중치를 매기고 가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분
   - 서버의 트래픽 처리 능력이 상이한 경우 사용되는 부하 분산 방식
 - IP 해시 방식
   - 클라이언트의 IP주소를 특정 서버로 매핑하여 요청을 처리하는 방식
   - 사용자의 IP를 해싱해서 로드를 분배하기 때문에 사용자가 항상 동일한 서버로 연결되는 것을 보장
 - 최소 연결 방식
   - 요청이 들어온 시점에 가장 적은 연결상태를 보이는 서버에 우선적으로 트래픽을 분배
   - 자주 세션이 길어지거나, 서버에 분배된 트래픽들이 일정하지 않은 경우 적합한 방식
 - 최소 응답 시간 방식
   - 서버의 현재 연결 상태와 응답시간을 모두 고려하여 트래픽을 배분
   - 가장 적은 연결 상태와 가장 짧은 응답 시간을 보이는 서버에 우선적으로 로드를 배분하는 방식

 ### L4 vs L7
 - L4, L7은 각각 Layer4(전송) 프로토콜과 Layer7(응용) 프로토콜의 헤더를 부하 분산에 이용하기 때문에 붙은 접두사

 #### L4 로드 밸런서
 - L4 로드 밸런서는 네트워크 계층(IP,IPX)이나 전송 계층(TCP, UDP)의 정보(IP주소, 포트번호, MAC주소)를 바탕으로 로드를 분산

 #### L7 로드 밸런서
 - L7 로드 밸런서는 애플리케이션 계층(HTTP, FTP, SMTP)에서 로드를 분산하기 때문에 HTTP 헤더, 쿠키 등과 같은 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능
 - 패킷의 내용을 확인하고 그 내용에 따라 로드를 특정 서버에 분배하는 것이 가능
 - URL에 따라 부하를 분산시키거나, HTTP 헤더의 쿠키 값에 따라 부하를 분산하는 등 클라이언트의 요청을 보다 세분화해 서버에 전달할 수 있다.
 - L7 로드 밸런서의 경우 특정한 패턴을 지닌 바이러스를 감지해 네트워크를 보호할 수 있고, DOS/DDOS와 같은 비정상적인 트래픽을 필터링할 수 있어 네트워크 보안 분야에서도 많이 활용되고 있음. 

# 질문
1. Apache와 Nginx의 특징에 대해서 말씀해주시고 동작원리의 차이를 설명해주세요.
2. 어떨 때 Apache를 쓰고 어떨 때 Nginx를 쓰는게 좋을까요?
3. SSL offloading에 대해서 말씀해주세요.
4. 리버스 프록시에 대해서 얘기해주세요.
5. 로드 밸런싱이 무엇인지 얘기해주세요.
6. 로드 밸런싱의 알고리즘에 대해서 아는대로 얘기해주세요.
7. L4 로드밸런서와 L7 로드밸런서의 차이에 대해서 설명해주세요.