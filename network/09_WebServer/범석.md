## 09. WebServer



## Web Server

### apache vs nginx (동작원리)

> Apache 
>
> > - 스레드 / 프로세스 기반 구조 
> >   - Apache는 클라이언트 요청당 하나의 스레드가 처리하는 구조. 
> >   - 사용자가 많으면 스레드 생성, 메모리 및 CPU 낭비가 심하다. 
> > - Multi-Process Module 
> >   - PreFork 방식 / Worker 방식
> >   - PreFork - 요청에 대해 default 개수만큼 자식 프로세스를 생성해서 처리하고, 요청이 많을경우 Process를 생성해서 처리하는 방식. 하나의 프로세스가 하나의 스레드를 가진다. 
> >   - Worker - Prefork와 같은 방법으로 자식 프로세스를 생성하고, 요청이 많을 경우 각 프로세스의 스레드를 생성해 처리하는방식. child process들이 각각 여러개의 
> > - 동적 컨텐츠 처리 
> > - 다양한 모듈 
> >
> > 단점 
> >
> > - 클라이언트 접속 마다 프로세스 혹은 스레드를 생성하는 구조이기 때문에 대량의 클라이언트가 동시 접속한다면 CPU/ 메모리 사용이 증가하고, 프로세스 / 스레드 생성 비요이 드는 등 요청에 한계가 있다. 
> > - Apache 서버의 프로세스가 Blocking되면 요청을 처리하지 못하고 처리가 완료될 때 까지 계속 대기한다. 
>
> Nginx
>
> > Apache의 C10K 문제점을 해결하기 위해 만들어진 Event-Driven 구조의 웹 서버 소프트웨어이다. 
> >
> > (프로그램의 흐름이 이벤트에 의해 결정되는 방식)
> >
> > - Event-Driven 처리 기반 구조 
> >   - 한 개 또는 고정된 프로세스만 생성하고, 여러개의 Connection을 모두 Event-Handler를 통해 비동기 방식으로 처리한다. 
> >   - 적은양의 스레드만 사용되기 때문에 Context Switching 비용이 적고, CPU 소모가 적다. 
> > - 리버스 프록시로 배치가능하다. 
> >
> > 단점
> >
> > - 동적 컨텐츠를 기본적으로 처리하지 못한다. 
> > - Apache에 비해 다양한 모듈이 없다. 

### SSL offloading 

> SSL Offloading은 서버대신 SSL Handshake, 데이터 암*복호화를 수행해 서버에 SSL 통신 관련 부하를 제거하고 클라이언트와 서버간의 SSL 암호화 통신을 제공하는 기능을 말한다. 
>
> [process]
>
> 1. 전달 : 클라이언트가 요청한 패킷은 Payload가 암호화되어 진입한다.
> 2. 복호화 : 패킷의 목적지 주소를 서버 IP로 수정한 후 Payload를 복호화한다.
> 3. 응답 : 분산 서버 서비스에서 운영서버로 Payload 전달 후 응답한다.
> 4. 회신 : Payload를 암호화 하고 출발지 주소를 요청 주소로 변환 후 전달한다.
>
> [기대 효과]
>
> - 비용 절감 : 별도의 Application 서버의 증설 비용이 상대적으로 절감된다.
> - 서버 성능 증대 : 서버의 암/복호화 작업으로 인한 불필요한 Load의 절감이 가능하다.
> - 관리 용이 : 암/복호화 작업의 집중화로 인한 관리 포인트가 용이하다.
>
> [참고 자료](https://m.blog.naver.com/security_reader/221773862307) 

### reverse proxy

> 프록시 서버 
>
> > 프록시 서버란 서버와 클라이언트 사이에 중계자로서 대리로 통신을 수행하는 서버를 프록시 서버라고 한다. 
>
> 리버스 프록시 서버는 웹서버 앞에 놓인다. 
>
> - 로드 밸런싱 
>   - 대량의 트래픽이 오가는 경우, 리버스 프록시 서버를 통해 특정 서버가 과부화 되지 않게 로드밸런싱이 가능하다.
> - 캐시 데이터 저장
>   - 먼 거리에 있는 서비스에 리버스 프록시를 통해 접속할 경우, 프록시 서버에 있는 캐싱되어 있는 데이터를 보내준다.
>
> [참고 자료](https://losskatsu.github.io/it-infra/reverse-proxy/#%EB%A6%AC%EB%B2%84%EC%8A%A4-%ED%94%84%EB%A1%9D%EC%8B%9Creverse-proxy-%EC%84%9C%EB%B2%84-%EA%B0%9C%EB%85%90)

### load balancing

> L7 vs L4
>
> L4 Load Balancing
>
> > 전송계층에서 작동하는 로드밸런서로 IP, PORT를 기준으로 스케줄링 알고리즘을 통해 부하를 분산한다. 
> >
> > 클라이언트에서 로드밸런서로 요청을 보낼 때 최적의 서버로 요청을 전송하고 결과를 클라이언트에게 건넨다. 
> >
> > 요청의 종류와 상관 없이 공장을 여러개 돌리는 것과 같다, 
>
> L7 Load Balancing
>
> > 애플리케이션에서 작동하는 로드밸런서로
> >
> > IP, PORT 이외에도 URI, Payload, Http Header, Cookie 등의 내용을 기준으로 부하를 분산한다. 
> >
> > L7 Load Balancer는 요청 내용을 분석해 특정 요청을 특정 서버로 전달하거나, 캐싱 및 압축등의 다양한 기능을 구현 할 수 있다. 
>



---

## Questions 

1. Apache와 Nginx에 대해서 간략히 설명해주세요.
2. SSL Offloading은 무엇인가요? 
3. SSL Offloading을 쓰는 이유는 무엇인가요?
4. Proxy 서버에 대해서 간략하게 설명해주세요
5. Reverse Proxy에 대해서 간략히 설명해주시고, Reverse Proxy를 통해서 얻을 수 있는 이점에 대해서 설명해주세요.
6. 로드 밸런싱에 대해서 설명해주세요. 
7. L4, L7 로드 밸런싱에 대해서 설명해주세요.
